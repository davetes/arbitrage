[build]
builder = "nixpacks"

[[services]]
name = "web"
source = "."
[services.web]
[services.web.build]
builder = "nixpacks"
[services.web.deploy]
startCommand = "python manage.py migrate && gunicorn arbbot.wsgi:application --bind 0.0.0.0:$PORT"
healthcheckPath = "/admin/"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[[services]]
name = "celery-worker"
source = "."
[services.celery-worker]
[services.celery-worker.build]
builder = "nixpacks"
[services.celery-worker.deploy]
startCommand = "celery -A arbbot worker -l info --uid=1000 --gid=1000"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[[services]]
name = "celery-beat"
source = "."
[services.celery-beat]
[services.celery-beat.build]
builder = "nixpacks"
[services.celery-beat.deploy]
startCommand = "celery -A arbbot beat -l info --uid=1000 --gid=1000"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[[services]]
name = "telegram-bot"
source = "."
[services.telegram-bot]
[services.telegram-bot.build]
builder = "nixpacks"
[services.telegram-bot.deploy]
startCommand = "python apps/telegram_bot/bot.py"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
